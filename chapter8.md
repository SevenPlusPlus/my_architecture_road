---

## 后台开放数据平台架构

### 背景和需求

- 业务拆分服务化后，业务库表数据也随着垂直拆分，但一些后台运营管理功能有多个业务表join复杂查询的需求，因此有构建业务全局查询表的需求；
- 业务开发中的搜索、热点缓存数据方案的需求，需要构建异构数据库；
- 业务运营活动开发中榜单等对数据查询量大、实时性要求的业务方案实现；
- 大数据部门的数据采集需求
- 合作方自研运营活动的需求

### 总体设计方案

![](/assets/直播平台后台数据开放平台.png)

### 结构化消息Apache Avro介绍

我们的方案中统一的结构化消息是一个重点，因此设计把埋点日志和数据库变更事件统一使用Apache Avro编码为结构化消息，使用Avro schema定义结构化消息的格式，通过一个公共的Schema registry服务来管理Schema的注册、查询及变更。

Avro是最近加入到Apache的Hadoop家族的项目之一。为支持数据密集型应用，它定义了一种数据格式并在多种编程语言中支持这种格式。

Avro提供的功能类似于其他编组系统，如Thrift、Protocol Buffers等。而Avro的主要不同之处在于:
	
	-	动态类型：Avro无需生成代码。数据总是伴以模式定义，这样就可以在不生成代码、静态数据类型的情况下对数据进行所有处理。这样有利于构建通用的数据处理系统和语言。
	-	无标记数据：由于在读取数据时有模式定义，这就大大减少了数据编辑所需的类型信息，从而减少序列化空间。
	-	不用手动分配的字段ID：当数据模式发生变化，处理数据时总是同时提供新旧模式，差异就可以用字段名来做符号化的分析。
		
		由于性能高、基本代码少和产出数据量精简等特点，Avro周围展开了众多活动——许多NoSQL实现，包括Hadoop、Cssandra等，都把Avro整合到它们的客户端API和储存功能中。

		### 关系数据库变更实时抓取同步系统

		![](/assets/关系数据库数据变更同步系统.png)

